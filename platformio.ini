[platformio]
default_envs = esp32s3-qspi
src_dir = firmware/src
include_dir = firmware/include

[env]
platform = espressif32@6.7.0
framework = arduino
monitor_speed = 115200
monitor_port = /dev/cu.usbmodem1101

; Default build flags
; Override DEBUG_LEVEL: pio run -b esp32s3-ospi -DDEBUG=1
build_flags =
  -DDEBUG=0
  -DUSER_SETUP_LOADED
  -include firmware/include/tft_setup.h

; Optional: HALF_STEP support
; Uncomment to enable: pio run -b esp32s3-ospi -DHALF_STEP
; -DHALF_STEP

; All libraries with pinned versions from sketch.yaml
lib_deps =
  PU2CLR SI4735@2.1.8
  TFT_eSPI@2.5.43
  mathieucarbou/ESP Async WebServer@3.0.6
  NTPClient@3.2.1
  ESP32-targz@1.3.1
  soburi/TinyCBOR@0.5.3-arduino2

; Board settings mapped from old FQBN:
; esp32:esp32:esp32s3:CDCOnBoot=cdc,FlashSize=8M,PSRAM=opi,CPUFreq=80,USBMode=hwcdc,FlashMode=qio,PartitionScheme=custom,DebugLevel=none
board_build.partitions = firmware/partitions.csv     ; PartitionScheme=custom
board_build.flash_size = 8MB                         ; FlashSize=8M
board_build.flash_mode = qio                         ; FlashMode=qio
board_build.f_cpu = 80000000L                        ; CPUFreq=80 (80MHz)
board_build.f_flash = 80000000L                      ; Flash frequency
build_type = release                                 ; DebugLevel=none (no debug symbols)
upload_speed = 921600

; USB settings for CDC on boot
board_build.arduino.usb_mode = 1                     ; USBMode=hwcdc
board_build.arduino.usb_on_boot = 1                  ; CDCOnBoot=cdc

; ESP32-S3 with OPI PSRAM (default profile)
[env:esp32s3-ospi]
board = esp32-s3-devkitc-1
board_build.psram = opi
build_flags =
  ${env.build_flags}
  -DBOARD_HAS_PSRAM

; ESP32-S3 with QSPI PSRAM (alternate profile)
[env:esp32s3-qspi]
board = esp32-s3-devkitc-1
; Correctly enable QSPI PSRAM for this board
board_build.arduino.memory_type = qio_qspi
board_build.psram_type = qspi
build_flags =
  ${env.build_flags}
  -DBOARD_HAS_PSRAM
  -mfix-esp32-psram-cache-issue
